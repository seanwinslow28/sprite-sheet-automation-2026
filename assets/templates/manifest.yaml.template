# Manifest for {{CHARACTER}} - {{MOVE}}
# Generated by: banana new-manifest
# Date: {{DATE}}

# ============================================================================
# IDENTITY - Who is this and what are they doing?
# ============================================================================
identity:
  character: "{{CHARACTER}}"     # Character ID (e.g., BLAZE, NOVA)
  move: "{{MOVE}}"               # Move ID (e.g., idle_standard, walk_forward)
  version: "v1"                  # Version for tracking changes
  frame_count: {{FRAME_COUNT}}   # Total frames in animation
  is_loop: true                  # Does animation loop? (idle, walk = true)

# ============================================================================
# INPUTS - Reference images for generation
# ============================================================================
inputs:
  # REQUIRED: The anchor/identity image (frame 0 reference)
  anchor: "assets/characters/{{CHARACTER_LOWER}}/anchor.png"

  # OPTIONAL: Style reference images (up to 6)
  style_refs:
    - "assets/characters/{{CHARACTER_LOWER}}/style_ref_1.png"

  # OPTIONAL: Pose reference images (uncomment to use)
  # pose_refs:
  #   - "assets/characters/{{CHARACTER_LOWER}}/pose_ref.png"

  # OPTIONAL: Grid overlay guides (uncomment to use)
  # guides:
  #   - "assets/guides/guide_{{TARGET_SIZE}}.png"

# ============================================================================
# GENERATOR - AI generation settings
# ============================================================================
generator:
  backend: "gemini"              # AI backend (gemini is only option for MVP)
  model: "gemini-2.0-flash-exp"  # Model ID
  mode: "edit"                   # edit (from reference) or generate
  seed_policy: "fixed_then_random"  # First attempt uses seed, retries randomize
  max_attempts_per_frame: 5      # Max retries per frame

  # Prompt templates (paths to files)
  prompts:
    master: "assets/prompts/{{CHARACTER_LOWER}}/master.txt"
    variation: "assets/prompts/{{CHARACTER_LOWER}}/variation.txt"
    lock: "assets/prompts/shared/lock.txt"
    negative: "assets/prompts/shared/negative.txt"

# ============================================================================
# CANVAS - Frame dimensions and alignment
# ============================================================================
canvas:
  generation_size: 512           # AI generates at this size (locked)
  target_size: {{TARGET_SIZE}}   # Final output size (128 or 256)
  downsample_method: "nearest"   # Always nearest for pixel art (locked)

  alignment:
    method: "contact_patch"      # contact_patch, center, or none
    vertical_lock: true          # Lock baseline to anchor
    root_zone_ratio: 0.15        # Bottom 15% for root detection
    max_shift_x: 32              # Safety clamp for horizontal shift

# ============================================================================
# AUDITOR - Quality gate thresholds
# ============================================================================
auditor:
  # Hard gates (HF01-HF05) - frames failing these are rejected
  hard_gates:
    HF01_DIMENSION_MISMATCH: 0    # Must be exact dimensions
    HF02_FORMAT_INVALID: 0        # Must be valid PNG
    HF03_ALPHA_MISSING: 0         # Must have alpha channel
    HF04_BASELINE_BREAK: 5        # Max baseline drift in pixels
    HF05_ANATOMY_BREAK: 0.5       # Min anatomy similarity

  # Soft metrics (SF01-SF05) - frames failing these trigger retry
  soft_metrics:
    SF01_IDENTITY_DRIFT: {{IDENTITY_MIN}}  # SSIM minimum
    SF02_PALETTE_DRIFT: 0.75               # Palette fidelity minimum
    SF03_TEMPORAL_JITTER: 0.10             # Max jitter between frames
    SF04_ALPHA_ARTIFACTS: 0.10             # Max alpha halo severity
    SF05_ORPHAN_PIXELS: 15                 # Max orphan pixels

  # Scoring weights for composite score
  weights:
    stability: 0.35
    identity: 0.30
    palette: 0.20
    style: 0.15

# ============================================================================
# RETRY - Failure recovery settings
# ============================================================================
retry:
  # Retry strategy ladder (actions to try on failure)
  ladder:
    - "retry_same"           # Just retry
    - "tighten_negative"     # Add more negative prompts
    - "identity_rescue"      # Focus on identity preservation
    - "re_anchor"            # Reset to anchor reference

  # Stop conditions - when to halt the run
  stop_conditions:
    max_retry_rate: 0.50         # Stop if >50% frames need retries
    max_reject_rate: 0.30        # Stop if >30% frames rejected
    max_consecutive_fails: 3     # Stop after 3 consecutive failures

# ============================================================================
# EXPORT - Atlas output settings (optional)
# ============================================================================
export:
  atlas_format: "phaser"         # Only phaser supported in MVP
  packer_flags: []               # Additional TexturePacker flags
